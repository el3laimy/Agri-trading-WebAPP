# Product Requirements Document (PRD)
# وثيقة متطلبات المنتج - نظام المحاسبة الزراعية

**الإصدار:** 1.0  
**التاريخ:** 2026-01-19  
**الحالة:** Production Ready

---

## 1. نظرة عامة (Overview)

### 1.1 اسم المنتج
**نظام المحاسبة الزراعية (Agri-Trading WebApp)**

### 1.2 الرؤية
نظام متكامل لإدارة عمليات تجارة المحاصيل الزراعية يشمل الشراء والبيع والمخزون والمحاسبة المالية.

### 1.3 المستخدم المستهدف
- **تجار المحاصيل الزراعية** في مصر والوطن العربي
- **مديرو المستودعات** الزراعية
- **المحاسبون** في القطاع الزراعي

### 1.4 المشكلة المُحلَّة
تعاني تجارة المحاصيل من:
- ❌ صعوبة تتبع المخزون بالوزن (إجمالي/صافي)
- ❌ تعقيد حسابات الخصم (التارة) والتحويل بين الوحدات
- ❌ عدم الربط بين العمليات التجارية والقيود المحاسبية
- ❌ صعوبة إدارة حسابات الموردين والعملاء

### 1.5 الحل
نظام شامل يوفر:
- ✅ إدارة مخزون بالوزن الإجمالي والصافي
- ✅ دعم خصومات التارة والتحويل التلقائي
- ✅ قيد محاسبي آلي لكل عملية
- ✅ تقارير مالية متكاملة

---

## 2. الميزات الرئيسية (Core Features)

### 2.1 إدارة المحاصيل (Crops Management)
| الميزة | الوصف | الأولوية |
|--------|-------|----------|
| محاصيل بسيطة | وحدة قياس واحدة (كجم) | P0 |
| محاصيل معقدة | وحدات متعددة مع معاملات تحويل | P0 |
| خصم التارة | خصم تلقائي لوزن العبوات | P0 |
| تسعير مرن | بالكيلو أو بالشكارة أو بالأردب | P0 |

### 2.2 عمليات الشراء (Purchases)
| الميزة | الوصف | الأولوية |
|--------|-------|----------|
| تسجيل شراء | من مورد مع الكمية والسعر | P0 |
| وزن إجمالي/صافي | حساب تلقائي للخصم | P0 |
| قيد محاسبي تلقائي | مدين: مخزون، دائن: مورد | P0 |
| تحديث المخزون | تلقائي عند الحفظ | P0 |

### 2.3 عمليات البيع (Sales)
| الميزة | الوصف | الأولوية |
|--------|-------|----------|
| تسجيل بيع | لعميل مع الكمية والسعر | P0 |
| حساب الربح | تكلفة vs سعر البيع | P0 |
| قيد محاسبي تلقائي | مدين: عميل، دائن: إيرادات | P0 |
| خصم المخزون | تلقائي عند الحفظ | P0 |

### 2.4 إدارة المخزون (Inventory)
| الميزة | الوصف | الأولوية |
|--------|-------|----------|
| تتبع الكمية | بالكيلوجرام والشكائر | P0 |
| دفعات المخزون | FIFO للتكلفة | P1 |
| تسوية المخزون | إضافة/خصم يدوي | P1 |
| تنبيه انخفاض المخزون | عتبة قابلة للتخصيص | P2 |

### 2.5 الخزينة والمدفوعات (Treasury)
| الميزة | الوصف | الأولوية |
|--------|-------|----------|
| قبض من عميل | تسجيل استلام نقدي | P0 |
| صرف لمورد | تسجيل دفع نقدي | P0 |
| تحويل بين الحسابات | من خزينة لأخرى | P1 |
| تسوية الأرصدة | مع جهات التعامل | P1 |

### 2.6 المصروفات (Expenses)
| الميزة | الوصف | الأولوية |
|--------|-------|----------|
| مصروفات يومية | نقل، عمالة، إيجار | P0 |
| تصنيف المصروفات | حسب النوع | P0 |
| ربط بالموسم | لحساب ربحية الموسم | P1 |

### 2.7 التقارير المالية (Reports)
| التقرير | الوصف | الأولوية |
|---------|-------|----------|
| دفتر اليومية | جميع القيود المحاسبية | P0 |
| ميزان المراجعة | أرصدة جميع الحسابات | P0 |
| قائمة الدخل | الإيرادات والمصروفات | P0 |
| الميزانية العمومية | الأصول والخصوم | P0 |
| دفتر الأستاذ العام | حركة حساب معين | P1 |
| قائمة التدفقات النقدية | حركة النقدية | P1 |

### 2.8 إدارة المستخدمين (User Management)
| الميزة | الوصف | الأولوية |
|--------|-------|----------|
| تسجيل الدخول | اسم مستخدم وكلمة مرور | P0 |
| الأدوار | مدير، محاسب، موظف | P0 |
| الصلاحيات | تحكم دقيق | P1 |
| سجل التدقيق | تتبع العمليات | P1 |

---

## 3. البنية التقنية (Technical Architecture)

### 3.1 مكونات النظام
```
┌─────────────────────────────────────────────────┐
│                  Frontend (React)                │
│      Vite + JavaScript + Vanilla CSS            │
└─────────────────────┬───────────────────────────┘
                      │ REST API
┌─────────────────────▼───────────────────────────┐
│               Backend (FastAPI)                  │
│          Python 3.x + SQLAlchemy                │
└─────────────────────┬───────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────┐
│             Database (SQLite)                    │
│          agri_trading.db                         │
└─────────────────────────────────────────────────┘
```

### 3.2 النماذج الأساسية (Core Models)
| النموذج | الوصف |
|---------|-------|
| `Crop` | المحاصيل ووحدات القياس |
| `Contact` | الموردين والعملاء |
| `Purchase` | عمليات الشراء |
| `Sale` | عمليات البيع |
| `Inventory` | أرصدة المخزون |
| `InventoryBatch` | دفعات المخزون |
| `Payment` | المدفوعات |
| `Expense` | المصروفات |
| `GeneralLedger` | دفتر اليومية |
| `FinancialAccount` | الحسابات المالية |
| `Season` | المواسم الزراعية |
| `User` | المستخدمين |
| `Role` | الأدوار والصلاحيات |

### 3.3 واجهات API الرئيسية
| المسار | الوصف |
|--------|-------|
| `/api/v1/auth/` | المصادقة وتسجيل الدخول |
| `/api/v1/crops/` | إدارة المحاصيل |
| `/api/v1/contacts/` | جهات التعامل |
| `/api/v1/purchases/` | عمليات الشراء |
| `/api/v1/sales/` | عمليات البيع |
| `/api/v1/inventory/` | المخزون |
| `/api/v1/payments/` | المدفوعات |
| `/api/v1/expenses/` | المصروفات |
| `/api/v1/reports/` | التقارير المالية |
| `/api/v1/seasons/` | المواسم |
| `/api/v1/users/` | المستخدمين |

---

## 4. صفحات الواجهة (UI Pages)

| الصفحة | المسار | الوصف |
|--------|--------|-------|
| تسجيل الدخول | `/login` | دخول المستخدم |
| لوحة التحكم | `/` | إحصائيات ورسوم بيانية |
| المبيعات | `/sales` | إدارة عمليات البيع |
| المشتريات | `/purchases` | إدارة عمليات الشراء |
| المخزون | `/inventory` | عرض أرصدة المخزون |
| الخزينة | `/treasury` | المدفوعات والتحصيلات |
| المصروفات | `/expenses` | المصروفات اليومية |
| جهات التعامل | `/contacts` | الموردين والعملاء |
| مركز التقارير | `/reports` | جميع التقارير |
| الإعدادات | `/settings/*` | إعدادات النظام |

---

## 5. قواعد العمل (Business Rules)

### 5.1 المحاسبة
- **مبدأ القيد المزدوج:** كل عملية تنشئ قيد مدين ودائن
- **التوازن المحاسبي:** مجموع المدين = مجموع الدائن دائماً
- **لا حذف للقيود:** فقط قيود عكسية

### 5.2 المخزون
- **FIFO:** الأقدم يخرج أولاً
- **لا بيع بالسالب:** المخزون ≥ 0 دائماً
- **التكلفة المرجحة:** لحساب تكلفة البضاعة المباعة

### 5.3 التسعير
- **المحاصيل البسيطة:** سعر × كمية بالكجم
- **المحاصيل المعقدة:** (سعر × وحدات) مع معامل تحويل

---

## 6. متطلبات غير وظيفية (Non-Functional Requirements)

| المتطلب | الهدف |
|---------|-------|
| الأداء | < 2 ثانية لتحميل أي صفحة |
| الاستجابة | تصميم متجاوب للجوال |
| الأمان | تشفير كلمات المرور، جلسات آمنة |
| التوفر | عمل محلي بدون إنترنت |
| اللغة | عربي بالكامل (RTL) |
| النسخ الاحتياطي | دعم التصدير والاستيراد |

---

## 7. خريطة الطريق (Roadmap)

### الإصدار 1.0 (الحالي) ✅
- [x] إدارة المحاصيل والمخزون
- [x] عمليات الشراء والبيع
- [x] الخزينة والمصروفات
- [x] التقارير الأساسية
- [x] لوحة تحكم تفاعلية

### الإصدار 1.1 (التالي)
- [ ] تطبيق جوال (PWA)
- [ ] تقارير متقدمة وتحليلات
- [ ] تكامل مع أنظمة الدفع
- [ ] تصدير Excel/PDF

### الإصدار 2.0 (مستقبلي)
- [ ] نظام سحابي متعدد المستأجرين
- [ ] ذكاء اصطناعي للتنبؤات
- [ ] تكامل مع API أسعار السوق
- [ ] تطبيقات موبايل أصلية

---

## 8. المخاطر والتحديات

| المخاطر | الاحتمال | التأثير | الحل |
|---------|----------|---------|------|
| فقدان البيانات | منخفض | عالي | نسخ احتياطي آلي |
| أخطاء الإدخال | متوسط | متوسط | تحقق من الصحة |
| عدم التوازن المحاسبي | منخفض | عالي | فحص آلي مستمر |
| بطء الأداء | متوسط | متوسط | فهرسة قاعدة البيانات |

---

## 9. معايير النجاح (Success Metrics)

| المقياس | الهدف |
|---------|-------|
| دقة الحسابات | 100% |
| رضا المستخدم | > 90% |
| وقت إكمال العملية | < 30 ثانية |
| معدل الأخطاء | < 1% |

---

## 10. الملاحق

### 10.1 مسرد المصطلحات
| المصطلح | التعريف |
|---------|---------|
| التارة | خصم وزن العبوات من الوزن الإجمالي |
| الأردب | وحدة قياس زراعية ≈ 150 كجم |
| الشكارة | كيس المحصول |
| FIFO | First In First Out - الأقدم يخرج أولاً |

### 10.2 شجرة الحسابات الافتراضية
```
الأصول (Assets)
├── النقدية (Cash)
│   ├── الخزينة الرئيسية
│   └── البنك
├── المدينون (Receivables)
│   └── ذمم العملاء
└── المخزون (Inventory)

الخصوم (Liabilities)
└── الدائنون (Payables)
    └── ذمم الموردين

حقوق الملكية (Equity)
├── رأس المال
└── الأرباح المحتجزة

الإيرادات (Revenue)
└── مبيعات المحاصيل

المصروفات (Expenses)
├── تكلفة البضاعة المباعة
├── مصروفات النقل
├── مصروفات العمالة
└── مصروفات إدارية
```

---

**تم إعداد هذه الوثيقة بواسطة:** Antigravity AI  
**آخر تحديث:** 2026-01-19
